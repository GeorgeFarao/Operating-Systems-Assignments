Γεώργιος Φαραώ 1115201700177

Αρχικα στην εργασια μου δημιουργω ενα πινακα μεγεθους Μ και τον γεμιζω με τυχαιους αριθμους. Επειτα δημιουργω την shared memory, οπου χωραει ενα int για το στοιχειο του πινακα και ενα long για τo timestamp, και τρεις σεμαφορους. Ο mtx ειναι για να περιμενουν τα child processes το feeder να γραψει στην μνημη, ο write_mtx ειναι για να περιμενει ο feeder μεχρι ολεσ οι διεργασιεσ να διαβασουν αυτο που εγραψε στην μνημη και ο file_sem ειναι για συγχρονισμο κατα την εγγραφη στο result.txt οπου εκει γραφουν τα αποτελεσματα την εκτελεσης τους οι διεργασιες. Μετα αρχικοποιω τους σεμαφορους και κανω down τον mtx ωστε οι διεργσιες, ποθ θα προσπαθησουν και αυτες να τον κατεβασουν, να περιμενουν και επειτα down και το write_mtx για να περιμενει ο feeder μεχρι να τον κανουν up οι διεργασιες.

Στην συνεχεια με fork δημιουργω n διεργασιες. Ο feeder-parent αρχικα για καθε στοιχειο του πινακα βρισκει το timestamp του και γραφει αυτο και το στοιχειο του πινακα στην shared memory. Μετα κανει up τους mtx για να ξεκινησουν οι διεργασιες να διαβαζουν και επιχειρει να κανει down τον write-mtx οπου θα αναγκαστει να περιμενει μεχρι ολες οι διεργασιες να τελειωσουν την αναγνωση απο την μνημη. Τελος ο feeder περιμενει ολα τα processes να τερματισουν και διαγραφει την shared memory και τους σεμαφορους.

Το καθε process που δημιουργηθηκε για καθε στοιχειο του πινακα παει και προσπαθει να το διαβασει. Αρχικα αναγκαζεται να περιμενει μεχρι να παρει το mtx του. Οταν το παρει διαβαζει απο την μνημη και μετα συγκρινει τα timestamp και προσθετει την διαφορα στο συνολο. Επισης κανει up τον write_mtx για να μπορει να συνεχισει ο feeder το γραψιμο.
Τελος καθε process παει και γραφει στο result.txt το pid της και τον πινακα με τα στοιχεια που διαβασε κανοντας down και up το file_sem πριν και μετα το γραψιμο ωστε μονο μια διεργασια να γραφει στο αρχειο καθε φορα.
 

